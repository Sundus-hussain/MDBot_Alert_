<!DOCTYPE html>
<html>
<head>
  <title>MDBot Tracker</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="styles.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
  <div class="profile-header">
    <img src="https://i.imgur.com/3GvwNBf.png" alt="Child Photo" class="child-photo" />
    <div>
      <h3>Mikaeel</h3>
      <small>Safety Tracker Enabled</small>
    </div>
  </div>

  <div id="map"></div>

  <button id="panicBtn">ðŸš¨</button>

  <script>
    const map = L.map('map').setView([0, 0], 13);
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors',
    }).addTo(map);
    const marker = L.marker([0, 0]).addTo(map);

    if (navigator.geolocation) {
      navigator.geolocation.watchPosition(
        (position) => {
          const lat = position.coords.latitude;
          const lng = position.coords.longitude;
          map.setView([lat, lng], 16);
          marker.setLatLng([lat, lng]).bindPopup("You are here").openPopup();
        },
        (error) => {
          alert("Please allow location access.");
        },
        { enableHighAccuracy: true }
      );
    }

    document.getElementById("panicBtn").addEventListener("click", () => {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(async (position) => {
          const lat = position.coords.latitude;
          const lng = position.coords.longitude;

          const response = await fetch("https://wos927xsmf.execute-api.eu-north-1.amazonaws.com/prod/SendEmergencyAlert", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              childId: "Mikaeel",
              lat,
              lng,
              timestamp: new Date().toISOString(),
            }),
          });

          alert(response.ok ? "ðŸš¨ Emergency alert sent!" : "Failed to send alert.");
        });
      }
    });
  </script>
</body>
</html>
